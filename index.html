<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>Latihan Hiragana & Katakana - Belajar Huruf Jepang Interaktif</title>
    <meta name="title" content="Latihan Hiragana & Katakana - Belajar Huruf Jepang Interaktif">
    <meta name="description" content="Web app gratis untuk belajar Hiragana dan Katakana dengan 3 mode latihan: Quiz, Menulis, dan Paragraph. Dilengkapi progress tracking, WPM calculator, dan statistik pembelajaran.">
    <meta name="keywords" content="belajar hiragana, belajar katakana, latihan huruf jepang, hiragana quiz, katakana quiz, belajar bahasa jepang, hiragana typing test, katakana typing test, japanese learning app">
    <meta name="author" content="Andre Purnomo">
    <meta name="language" content="Indonesian">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://andrepurnomo.github.io/belajar-jepang/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://andrepurnomo.github.io/belajar-jepang/">
    <meta property="og:title" content="Latihan Hiragana & Katakana - Belajar Huruf Jepang Interaktif">
    <meta property="og:description" content="Web app gratis untuk belajar Hiragana dan Katakana dengan 3 mode latihan interaktif. Track progress kamu dan tingkatkan kemampuan membaca huruf Jepang!">
    <meta property="og:image" content="https://andrepurnomo.github.io/belajar-jepang/og-image.png">
    <meta property="og:locale" content="id_ID">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://andrepurnomo.github.io/belajar-jepang/">
    <meta property="twitter:title" content="Latihan Hiragana & Katakana - Belajar Huruf Jepang Interaktif">
    <meta property="twitter:description" content="Web app gratis untuk belajar Hiragana dan Katakana dengan 3 mode latihan interaktif. Track progress kamu dan tingkatkan kemampuan membaca huruf Jepang!">
    <meta property="twitter:image" content="https://andrepurnomo.github.io/belajar-jepang/og-image.png">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#3B82F6">
    <meta name="msapplication-TileColor" content="#3B82F6">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://code.jquery.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Structured Data / JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Latihan Hiragana & Katakana",
      "applicationCategory": "EducationalApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": "Web app gratis untuk belajar Hiragana dan Katakana dengan 3 mode latihan: Quiz, Menulis, dan Paragraph. Dilengkapi progress tracking dan statistik pembelajaran.",
      "url": "https://andrepurnomo.github.io/belajar-jepang/",
      "author": {
        "@type": "Person",
        "name": "Andre Purnomo"
      },
      "inLanguage": "id",
      "featureList": "Quiz Mode, Writing Mode, Paragraph Mode, Progress Tracking, WPM Calculator, Statistics Dashboard",
      "screenshot": "https://andrepurnomo.github.io/belajar-jepang/screenshot.png"
    }
    </script>
</head>
<body class="bg-gray-100 min-h-screen">
    
    <!-- Page 1: Pilih Jenis -->
    <div id="page-select-type" class="container mx-auto px-4 py-16">
        <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-8">
            <h1 class="text-4xl font-bold text-center mb-8 text-gray-800">Latihan Huruf Jepang</h1>
            <p class="text-center text-gray-600 mb-8">Pilih jenis huruf yang ingin kamu pelajari:</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <button onclick="selectType('hiragana')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-12 px-8 rounded-xl transition duration-300 transform hover:scale-105">
                    <div class="text-5xl mb-4">„ÅÇ</div>
                    <div class="text-2xl">Hiragana</div>
                </button>
                <button onclick="selectType('katakana')" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-12 px-8 rounded-xl transition duration-300 transform hover:scale-105">
                    <div class="text-5xl mb-4">„Ç¢</div>
                    <div class="text-2xl">Katakana</div>
                </button>
            </div>
            
            <button onclick="showStats()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-xl transition duration-300">
                üìä Lihat Statistik & Progress
            </button>
        </div>
    </div>

    <!-- Page 2: Pilih Huruf -->
    <div id="page-select-chars" class="container mx-auto px-4 py-16 hidden">
        <div class="max-w-6xl mx-auto bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Pilih Huruf untuk Latihan</h2>
            <p class="text-center text-gray-600 mb-8">Klik grup untuk memilih satu baris, atau centang manual (minimal 5):</p>
            
            <div id="weak-chars-banner" class="hidden bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4 mb-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-lg font-bold text-yellow-800">üí° Huruf yang Perlu Diperbaiki</h3>
                        <p class="text-sm text-yellow-700" id="weak-chars-list"></p>
                    </div>
                    <button onclick="practiceWeakChars()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                        Latih Sekarang
                    </button>
                </div>
            </div>
            
            <div id="char-selection" class="space-y-6 mb-8">
                <!-- Will be populated by JavaScript -->
            </div>
            
            <div class="flex justify-between items-center">
                <button onclick="backToTypeSelection()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                    ‚Üê Kembali
                </button>
                <button onclick="showModeSelection()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-lg transition duration-300">
                    Lanjut ‚Üí
                </button>
            </div>
        </div>
    </div>

    <!-- Page 2.5: Pilih Mode -->
    <div id="page-select-mode" class="container mx-auto px-4 py-16 hidden">
        <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Pilih Mode Latihan</h2>
            <p class="text-center text-gray-600 mb-8">Pilih jenis latihan yang ingin kamu lakukan:</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <button onclick="startQuiz()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-12 px-8 rounded-xl transition duration-300 transform hover:scale-105">
                    <div class="text-5xl mb-4">‚ùì</div>
                    <div class="text-2xl mb-2">Mode Quiz</div>
                    <div class="text-sm opacity-90">Pilih jawaban yang benar</div>
                </button>
                <button onclick="startWritingMode()" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-12 px-8 rounded-xl transition duration-300 transform hover:scale-105">
                    <div class="text-5xl mb-4">‚úçÔ∏è</div>
                    <div class="text-2xl mb-2">Mode Menulis</div>
                    <div class="text-sm opacity-90">Klik huruf sesuai urutan</div>
                </button>
                <button onclick="startParagraphMode()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-12 px-8 rounded-xl transition duration-300 transform hover:scale-105">
                    <div class="text-5xl mb-4">üìñ</div>
                    <div class="text-2xl mb-2">Mode Paragraph</div>
                    <div class="text-sm opacity-90">Ketik romanji dengan cepat</div>
                </button>
            </div>
            
            <button onclick="backToCharSelection()" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                ‚Üê Kembali
            </button>
        </div>
    </div>

    <!-- Page 3: Quiz -->
    <div id="page-quiz" class="container mx-auto px-4 py-16 hidden">
        <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-8">
            <div class="flex justify-between items-center mb-8">
                <div class="text-lg font-semibold text-gray-700">
                    Soal <span id="current-question">1</span> / <span id="total-questions">10</span>
                </div>
                <div class="text-lg font-semibold text-blue-600">
                    ‚è±Ô∏è <span id="timer">00:00</span>
                </div>
            </div>
            
            <div class="text-center mb-8">
                <div class="text-8xl font-bold mb-8 text-gray-800" id="question-char">„ÅÇ</div>
                <p class="text-xl text-gray-600 mb-6">Bagaimana cara membaca huruf ini?</p>
            </div>
            
            <div id="answer-options" class="grid grid-cols-2 gap-4">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Page 3.3: Paragraph Mode -->
    <div id="page-paragraph" class="container mx-auto px-4 py-16 hidden">
        <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8">
            <div class="flex justify-between items-center mb-8">
                <div class="text-lg font-semibold text-gray-700">
                    Mode Paragraph
                </div>
                <div class="flex gap-6 text-sm font-semibold">
                    <div class="text-green-600">‚è±Ô∏è <span id="paragraph-timer">00:00</span></div>
                    <div class="text-blue-600">üéØ <span id="paragraph-accuracy">100</span>%</div>
                    <div class="text-purple-600">‚ö° <span id="paragraph-wpm">0</span> WPM</div>
                </div>
            </div>
            
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-4 text-gray-700">Baca dan ketik dalam romanji:</h3>
                <div class="bg-gray-50 rounded-lg p-6 mb-4">
                    <div id="paragraph-display" class="text-4xl leading-relaxed flex flex-wrap gap-2">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-lg font-semibold text-gray-700">Ketik di sini:</h3>
                    <div class="text-sm text-gray-500">Progress: <span id="paragraph-progress">0</span>/<span id="paragraph-total">0</span></div>
                </div>
                <input 
                    type="text" 
                    id="paragraph-input" 
                    class="w-full text-2xl p-4 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none font-mono"
                    placeholder="Mulai ketik..."
                    autocomplete="off"
                    spellcheck="false"
                />
                <div class="mt-2 text-sm text-gray-500">
                    üí° Tips: Ketik romanji untuk setiap huruf. Contoh: „ÅÇ = a, „Åó = shi, „Å° = chi
                </div>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4">
                <div class="h-4 bg-gray-200 rounded-full overflow-hidden">
                    <div id="paragraph-progress-bar" class="h-full bg-green-500 transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 3.5: Writing Mode -->
    <div id="page-writing" class="container mx-auto px-4 py-16 hidden">
        <div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-xl p-8">
            <div class="flex justify-between items-center mb-8">
                <div class="text-lg font-semibold text-gray-700">
                    Soal <span id="writing-current-question">1</span> / <span id="writing-total-questions">10</span>
                </div>
                <div class="text-lg font-semibold text-purple-600">
                    ‚è±Ô∏è <span id="writing-timer">00:00</span>
                </div>
            </div>
            
            <div class="text-center mb-8">
                <p class="text-xl text-gray-600 mb-4">Tulis urutan huruf ini:</p>
                <div class="bg-purple-50 rounded-lg p-6 mb-6">
                    <div class="text-3xl font-bold text-purple-800" id="writing-prompt">ka ki ku ke ko</div>
                </div>
                
                <div class="mb-6">
                    <p class="text-sm text-gray-500 mb-2">Yang sudah kamu tulis:</p>
                    <div class="bg-gray-50 rounded-lg p-4 min-h-[80px] flex items-center justify-center flex-wrap gap-2" id="writing-answer">
                        <span class="text-gray-400 italic" id="writing-placeholder">Klik huruf di bawah...</span>
                    </div>
                </div>
            </div>
            
            <div class="mb-6">
                <p class="text-sm text-gray-600 mb-3 text-center">Pilih huruf:</p>
                <div id="writing-options" class="grid grid-cols-3 sm:grid-cols-5 gap-3">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="flex justify-center gap-3">
                <button onclick="clearWritingAnswer()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200">
                    üîÑ Reset
                </button>
                <button onclick="submitWritingAnswer()" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-8 rounded-lg transition duration-200">
                    Kirim Jawaban
                </button>
            </div>
        </div>
    </div>

    <!-- Page 4: Results -->
    <div id="page-results" class="container mx-auto px-4 py-16 hidden">
        <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-4xl font-bold text-center mb-8 text-gray-800">Hasil Latihan</h2>
            
            <div id="improvement-message" class="hidden bg-green-50 border-2 border-green-300 rounded-lg p-4 mb-6 text-center">
                <p class="text-green-800 font-semibold text-lg"></p>
            </div>
            
            <div class="bg-blue-50 rounded-xl p-8 mb-8">
                <div class="text-center mb-6">
                    <div class="text-6xl font-bold mb-2" id="final-score">0</div>
                    <div class="text-xl text-gray-700">Nilai Akhir</div>
                </div>
                
                <div class="grid grid-cols-2 gap-6 text-center">
                    <div>
                        <div class="text-3xl font-bold text-green-600" id="correct-answers">0</div>
                        <div class="text-gray-600">Benar</div>
                    </div>
                    <div>
                        <div class="text-3xl font-bold text-red-600" id="wrong-answers">0</div>
                        <div class="text-gray-600">Salah</div>
                    </div>
                </div>
                
                <div class="text-center mt-6">
                    <div class="text-2xl font-bold text-blue-600" id="time-taken">00:00</div>
                    <div class="text-gray-600">Waktu yang Dibutuhkan</div>
                </div>
            </div>
            
            <div class="flex justify-center gap-4">
                <button onclick="restartQuiz()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg transition duration-300">
                    Ulangi Latihan
                </button>
                <button onclick="backToStart()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-lg transition duration-300">
                    Kembali ke Awal
                </button>
            </div>
        </div>
    </div>

    <!-- Page 5: Statistics Dashboard -->
    <div id="page-stats" class="container mx-auto px-4 py-16 hidden">
        <div class="max-w-6xl mx-auto">
            <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
                <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">üìä Statistik & Progress</h2>
                
                <!-- Overview Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-blue-50 rounded-lg p-4 text-center">
                        <div class="text-3xl font-bold text-blue-600" id="stat-total-sessions">0</div>
                        <div class="text-sm text-gray-600">Total Sesi</div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4 text-center">
                        <div class="text-3xl font-bold text-green-600" id="stat-accuracy">0%</div>
                        <div class="text-sm text-gray-600">Akurasi</div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4 text-center">
                        <div class="text-3xl font-bold text-purple-600" id="stat-total-time">0m</div>
                        <div class="text-sm text-gray-600">Total Waktu</div>
                    </div>
                    <div class="bg-orange-50 rounded-lg p-4 text-center">
                        <div class="text-3xl font-bold text-orange-600" id="stat-streak">0</div>
                        <div class="text-sm text-gray-600">Streak üî•</div>
                    </div>
                </div>
                
                <!-- Progress Chart -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 text-gray-700">Progress 10 Sesi Terakhir</h3>
                    <canvas id="progress-chart" height="80"></canvas>
                </div>
                
                <!-- Weak Characters -->
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <h3 class="text-xl font-bold mb-4 text-red-600">‚ö†Ô∏è Huruf yang Perlu Diperbaiki</h3>
                        <div id="weak-chars-list-stats" class="space-y-2">
                            <p class="text-gray-500 italic">Belum ada data</p>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold mb-4 text-green-600">‚úÖ Huruf yang Sudah Dikuasai</h3>
                        <div id="mastered-chars-list" class="space-y-2">
                            <p class="text-gray-500 italic">Belum ada data</p>
                        </div>
                    </div>
                </div>
                
                <button onclick="backToStart()" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-lg transition duration-300">
                    ‚Üê Kembali ke Menu
                </button>
            </div>
        </div>
    </div>

    <script>
        const hiraganaGroups = [
            { name: 'Vokal (A)', chars: { 'a': '„ÅÇ', 'i': '„ÅÑ', 'u': '„ÅÜ', 'e': '„Åà', 'o': '„Åä' } },
            { name: 'K', chars: { 'ka': '„Åã', 'ki': '„Åç', 'ku': '„Åè', 'ke': '„Åë', 'ko': '„Åì' } },
            { name: 'S', chars: { 'sa': '„Åï', 'shi': '„Åó', 'su': '„Åô', 'se': '„Åõ', 'so': '„Åù' } },
            { name: 'T', chars: { 'ta': '„Åü', 'chi': '„Å°', 'tsu': '„Å§', 'te': '„Å¶', 'to': '„Å®' } },
            { name: 'N', chars: { 'na': '„Å™', 'ni': '„Å´', 'nu': '„Å¨', 'ne': '„Å≠', 'no': '„ÅÆ' } },
            { name: 'H', chars: { 'ha': '„ÅØ', 'hi': '„Å≤', 'fu': '„Åµ', 'he': '„Å∏', 'ho': '„Åª' } },
            { name: 'M', chars: { 'ma': '„Åæ', 'mi': '„Åø', 'mu': '„ÇÄ', 'me': '„ÇÅ', 'mo': '„ÇÇ' } },
            { name: 'Y', chars: { 'ya': '„ÇÑ', 'yu': '„ÇÜ', 'yo': '„Çà' } },
            { name: 'R', chars: { 'ra': '„Çâ', 'ri': '„Çä', 'ru': '„Çã', 're': '„Çå', 'ro': '„Çç' } },
            { name: 'W/N', chars: { 'wa': '„Çè', 'wo': '„Çí', 'n': '„Çì' } }
        ];

        const katakanaGroups = [
            { name: 'Vokal (A)', chars: { 'a': '„Ç¢', 'i': '„Ç§', 'u': '„Ç¶', 'e': '„Ç®', 'o': '„Ç™' } },
            { name: 'K', chars: { 'ka': '„Ç´', 'ki': '„Ç≠', 'ku': '„ÇØ', 'ke': '„Ç±', 'ko': '„Ç≥' } },
            { name: 'S', chars: { 'sa': '„Çµ', 'shi': '„Ç∑', 'su': '„Çπ', 'se': '„Çª', 'so': '„ÇΩ' } },
            { name: 'T', chars: { 'ta': '„Çø', 'chi': '„ÉÅ', 'tsu': '„ÉÑ', 'te': '„ÉÜ', 'to': '„Éà' } },
            { name: 'N', chars: { 'na': '„Éä', 'ni': '„Éã', 'nu': '„Éå', 'ne': '„Éç', 'no': '„Éé' } },
            { name: 'H', chars: { 'ha': '„Éè', 'hi': '„Éí', 'fu': '„Éï', 'he': '„Éò', 'ho': '„Éõ' } },
            { name: 'M', chars: { 'ma': '„Éû', 'mi': '„Éü', 'mu': '„É†', 'me': '„É°', 'mo': '„É¢' } },
            { name: 'Y', chars: { 'ya': '„É§', 'yu': '„É¶', 'yo': '„É®' } },
            { name: 'R', chars: { 'ra': '„É©', 'ri': '„É™', 'ru': '„É´', 're': '„É¨', 'ro': '„É≠' } },
            { name: 'W/N', chars: { 'wa': '„ÉØ', 'wo': '„É≤', 'n': '„É≥' } }
        ];

        const hiraganaChars = {};
        hiraganaGroups.forEach(g => Object.assign(hiraganaChars, g.chars));
        
        const katakanaChars = {};
        katakanaGroups.forEach(g => Object.assign(katakanaChars, g.chars));

        let selectedType = '';
        let selectedChars = {};
        let quizData = [];
        let currentQuestionIndex = 0;
        let correctCount = 0;
        let wrongCount = 0;
        let startTime = 0;
        let timerInterval = null;
        let currentSessionAnswers = [];
        let progressChart = null;
        let writingData = [];
        let currentWritingIndex = 0;
        let currentWritingAnswer = [];
        let currentWritingQuestion = [];
        let currentMode = 'quiz';
        let paragraphData = [];
        let paragraphCurrentIndex = 0;
        let paragraphInput = '';
        let paragraphCorrectCount = 0;
        let paragraphWrongCount = 0;
        let paragraphStartTime = 0;
        let paragraphTimerInterval = null;

        // LocalStorage functions
        function getStats() {
            const stats = localStorage.getItem('japaneseStats');
            return stats ? JSON.parse(stats) : {
                totalSessions: 0,
                lastPlayed: null,
                hiraganaStats: { totalAttempts: 0, correctCount: 0, charDetails: {} },
                katakanaStats: { totalAttempts: 0, correctCount: 0, charDetails: {} },
                sessionHistory: []
            };
        }

        function saveStats(stats) {
            localStorage.setItem('japaneseStats', JSON.stringify(stats));
        }

        function updateCharStats(type, romaji, isCorrect) {
            const stats = getStats();
            const typeStats = type === 'hiragana' ? stats.hiraganaStats : stats.katakanaStats;
            
            if (!typeStats.charDetails[romaji]) {
                typeStats.charDetails[romaji] = { correct: 0, wrong: 0, lastSeen: null };
            }
            
            if (isCorrect) {
                typeStats.charDetails[romaji].correct++;
                typeStats.correctCount++;
            } else {
                typeStats.charDetails[romaji].wrong++;
            }
            
            typeStats.charDetails[romaji].lastSeen = new Date().toISOString().split('T')[0];
            typeStats.totalAttempts++;
            
            saveStats(stats);
        }

        function getWeakChars(type, limit = 5) {
            const stats = getStats();
            const typeStats = type === 'hiragana' ? stats.hiraganaStats : stats.katakanaStats;
            const charDetails = typeStats.charDetails;
            
            const charArray = Object.keys(charDetails)
                .map(romaji => ({
                    romaji,
                    accuracy: (charDetails[romaji].correct / (charDetails[romaji].correct + charDetails[romaji].wrong)) * 100,
                    total: charDetails[romaji].correct + charDetails[romaji].wrong
                }))
                .filter(char => char.total >= 3)
                .sort((a, b) => a.accuracy - b.accuracy)
                .slice(0, limit);
            
            return charArray;
        }

        function getMasteredChars(type) {
            const stats = getStats();
            const typeStats = type === 'hiragana' ? stats.hiraganaStats : stats.katakanaStats;
            const charDetails = typeStats.charDetails;
            
            return Object.keys(charDetails)
                .filter(romaji => {
                    const char = charDetails[romaji];
                    const total = char.correct + char.wrong;
                    const accuracy = (char.correct / total) * 100;
                    return total >= 5 && accuracy >= 90;
                })
                .map(romaji => ({
                    romaji,
                    accuracy: (charDetails[romaji].correct / (charDetails[romaji].correct + charDetails[romaji].wrong)) * 100
                }));
        }

        function calculateStreak() {
            const stats = getStats();
            if (stats.sessionHistory.length === 0) return 0;
            
            const today = new Date().toISOString().split('T')[0];
            const sessions = stats.sessionHistory.map(s => s.date).sort();
            
            let streak = 0;
            let currentDate = new Date(today);
            
            for (let i = 0; i < 365; i++) {
                const dateStr = currentDate.toISOString().split('T')[0];
                if (sessions.includes(dateStr)) {
                    streak++;
                    currentDate.setDate(currentDate.getDate() - 1);
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function selectType(type) {
            selectedType = type;
            selectedChars = type === 'hiragana' ? {...hiraganaChars} : {...katakanaChars};
            
            $('#page-select-type').addClass('hidden');
            $('#page-select-chars').removeClass('hidden');
            
            renderCharSelection();
            showWeakCharsBanner();
        }

        function showWeakCharsBanner() {
            const weakChars = getWeakChars(selectedType, 5);
            if (weakChars.length > 0) {
                const charsList = weakChars.map(c => `${c.romaji} (${Math.round(c.accuracy)}%)`).join(', ');
                $('#weak-chars-list').text(charsList);
                $('#weak-chars-banner').removeClass('hidden');
            } else {
                $('#weak-chars-banner').addClass('hidden');
            }
        }

        function practiceWeakChars() {
            $('.char-checkbox').prop('checked', false).trigger('change');
            
            const weakChars = getWeakChars(selectedType, 10);
            weakChars.forEach(char => {
                $(`.char-checkbox[value="${char.romaji}"]`).prop('checked', true).trigger('change');
            });
        }

        function renderCharSelection() {
            const charSelection = $('#char-selection');
            charSelection.empty();
            
            const groups = selectedType === 'hiragana' ? hiraganaGroups : katakanaGroups;
            
            groups.forEach((group, groupIndex) => {
                const groupHtml = `
                    <div class="border-2 border-gray-200 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold text-gray-700">Baris ${group.name}</h3>
                            <button onclick="toggleGroup(${groupIndex})" class="group-btn-${groupIndex} bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition duration-200">
                                Pilih Semua
                            </button>
                        </div>
                        <div class="grid grid-cols-3 sm:grid-cols-5 gap-3 group-${groupIndex}">
                            ${Object.keys(group.chars).map(romaji => {
                                const char = group.chars[romaji];
                                return `
                                    <label class="char-label relative flex items-center justify-center p-4 border-2 border-gray-300 bg-white opacity-50 rounded-lg cursor-pointer hover:shadow-lg transition duration-200">
                                        <input type="checkbox" value="${romaji}" class="hidden char-checkbox">
                                        <div class="text-center">
                                            <div class="absolute top-1 right-1 text-green-600 text-xl checkmark" style="display:none;">‚úì</div>
                                            <div class="text-3xl mb-2">${char}</div>
                                            <div class="text-sm font-semibold">${romaji}</div>
                                        </div>
                                    </label>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
                charSelection.append(groupHtml);
            });
            
            $('.char-checkbox').change(function() {
                const label = $(this).parent();
                if ($(this).is(':checked')) {
                    label.removeClass('border-gray-300 bg-white opacity-50');
                    label.addClass('border-blue-500 bg-blue-50');
                    label.find('.checkmark').show();
                } else {
                    label.removeClass('border-blue-500 bg-blue-50');
                    label.addClass('border-gray-300 bg-white opacity-50');
                    label.find('.checkmark').hide();
                }
            });
        }

        function toggleGroup(groupIndex) {
            const checkboxes = $(`.group-${groupIndex} .char-checkbox`);
            const allChecked = checkboxes.filter(':checked').length === checkboxes.length;
            
            checkboxes.each(function() {
                const wasChecked = $(this).is(':checked');
                if (allChecked && wasChecked) {
                    $(this).prop('checked', false).trigger('change');
                } else if (!allChecked && !wasChecked) {
                    $(this).prop('checked', true).trigger('change');
                }
            });
            
            const btn = $(`.group-btn-${groupIndex}`);
            if (allChecked) {
                btn.text('Pilih Semua');
                btn.removeClass('bg-red-500 hover:bg-red-600').addClass('bg-blue-500 hover:bg-blue-600');
            } else {
                btn.text('Batalkan');
                btn.removeClass('bg-blue-500 hover:bg-blue-600').addClass('bg-red-500 hover:bg-red-600');
            }
        }

        function backToTypeSelection() {
            $('#page-select-chars').addClass('hidden');
            $('#page-select-type').removeClass('hidden');
        }

        function showModeSelection() {
            const checked = $('.char-checkbox:checked');
            if (checked.length < 5) {
                alert('Pilih minimal 5 huruf untuk latihan!');
                return;
            }
            
            $('#page-select-chars').addClass('hidden');
            $('#page-select-mode').removeClass('hidden');
        }

        function backToCharSelection() {
            $('#page-select-mode').addClass('hidden');
            $('#page-select-chars').removeClass('hidden');
        }

        function startParagraphMode() {
            const checked = $('.char-checkbox:checked');
            currentMode = 'paragraph';
            
            const allRomaji = [];
            checked.each(function() {
                allRomaji.push($(this).val());
            });
            
            paragraphData = generateParagraph(allRomaji, 60);
            paragraphCurrentIndex = 0;
            paragraphInput = '';
            paragraphCorrectCount = 0;
            paragraphWrongCount = 0;
            correctCount = 0;
            wrongCount = 0;
            currentSessionAnswers = [];
            
            $('#page-select-mode').addClass('hidden');
            $('#page-paragraph').removeClass('hidden');
            
            renderParagraph();
            setupParagraphInput();
        }

        function generateParagraph(allRomaji, length = 60) {
            const paragraph = [];
            for (let i = 0; i < length; i++) {
                const randomRomaji = allRomaji[Math.floor(Math.random() * allRomaji.length)];
                paragraph.push({
                    romaji: randomRomaji,
                    char: selectedChars[randomRomaji],
                    status: 'pending'
                });
            }
            return paragraph;
        }

        function renderParagraph() {
            const container = $('#paragraph-display');
            container.empty();
            
            paragraphData.forEach((item, index) => {
                let bgColor = 'bg-gray-200';
                let textColor = 'text-gray-800';
                
                if (item.status === 'correct') {
                    bgColor = 'bg-green-100';
                    textColor = 'text-green-800';
                } else if (item.status === 'wrong') {
                    bgColor = 'bg-red-100';
                    textColor = 'text-red-800';
                } else if (item.status === 'partial') {
                    bgColor = 'bg-yellow-100';
                    textColor = 'text-yellow-800';
                } else if (index === paragraphCurrentIndex) {
                    bgColor = 'bg-blue-100';
                    textColor = 'text-blue-800';
                }
                
                container.append(`
                    <div class="inline-flex items-center justify-center ${bgColor} ${textColor} rounded-lg p-2 min-w-[50px]">
                        <div class="text-4xl">${item.char}</div>
                    </div>
                `);
            });
            
            $('#paragraph-total').text(paragraphData.length);
            $('#paragraph-progress').text(paragraphCurrentIndex);
            
            const progress = (paragraphCurrentIndex / paragraphData.length) * 100;
            $('#paragraph-progress-bar').css('width', progress + '%');
        }

        function setupParagraphInput() {
            const input = $('#paragraph-input');
            input.val('');
            input.prop('disabled', false);
            input.focus();
            
            paragraphStartTime = Date.now();
            startParagraphTimer();
            
            input.off('input').on('input', function(e) {
                handleParagraphInput($(this).val());
            });
            
            input.off('keydown').on('keydown', function(e) {
                if (e.key === 'Backspace' && paragraphInput.length > 0) {
                    const currentChar = paragraphData[paragraphCurrentIndex];
                    if (currentChar.status === 'partial') {
                        currentChar.status = 'pending';
                        renderParagraph();
                    }
                }
            });
        }

        function handleParagraphInput(value) {
            if (paragraphCurrentIndex >= paragraphData.length) {
                return;
            }
            
            const currentChar = paragraphData[paragraphCurrentIndex];
            const expectedRomaji = currentChar.romaji;
            const input = value.toLowerCase().trim();
            
            paragraphInput = input;
            
            if (expectedRomaji === input) {
                currentChar.status = 'correct';
                paragraphCorrectCount++;
                paragraphCurrentIndex++;
                $('#paragraph-input').val('');
                paragraphInput = '';
                renderParagraph();
                updateParagraphMetrics();
                
                if (paragraphCurrentIndex >= paragraphData.length) {
                    finishParagraph();
                }
            } else if (expectedRomaji.startsWith(input) && input.length > 0) {
                currentChar.status = 'partial';
                renderParagraph();
            } else if (input.length > 0 && !expectedRomaji.startsWith(input)) {
                currentChar.status = 'wrong';
                paragraphWrongCount++;
                renderParagraph();
            } else {
                currentChar.status = 'pending';
                renderParagraph();
            }
        }

        function startParagraphTimer() {
            paragraphTimerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - paragraphStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                $('#paragraph-timer').text(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);
                
                updateParagraphMetrics();
            }, 100);
        }

        function updateParagraphMetrics() {
            const totalAttempts = paragraphCorrectCount + paragraphWrongCount;
            const accuracy = totalAttempts > 0 ? Math.round((paragraphCorrectCount / totalAttempts) * 100) : 100;
            $('#paragraph-accuracy').text(accuracy);
            
            const elapsedMinutes = (Date.now() - paragraphStartTime) / 1000 / 60;
            const wpm = elapsedMinutes > 0 ? Math.round(paragraphCorrectCount / elapsedMinutes) : 0;
            $('#paragraph-wpm').text(wpm);
        }

        function finishParagraph() {
            clearInterval(paragraphTimerInterval);
            $('#paragraph-input').prop('disabled', true);
            
            correctCount = paragraphCorrectCount;
            wrongCount = paragraphWrongCount;
            
            paragraphData.forEach(item => {
                const isCorrect = item.status === 'correct';
                updateCharStats(selectedType, item.romaji, isCorrect);
                currentSessionAnswers.push({ romaji: item.romaji, isCorrect });
            });
            
            setTimeout(() => {
                endQuiz();
            }, 1500);
        }

        function startQuiz() {
            const checked = $('.char-checkbox:checked');
            currentMode = 'quiz';
            
            quizData = [];
            checked.each(function() {
                const romaji = $(this).val();
                quizData.push({
                    char: selectedChars[romaji],
                    correct: romaji
                });
            });
            
            quizData = shuffleArray(quizData);
            currentQuestionIndex = 0;
            correctCount = 0;
            wrongCount = 0;
            currentSessionAnswers = [];
            
            $('#page-select-mode').addClass('hidden');
            $('#page-quiz').removeClass('hidden');
            
            startTime = Date.now();
            startTimer();
            showQuestion();
        }

        function startWritingMode() {
            const checked = $('.char-checkbox:checked');
            currentMode = 'writing';
            
            const allRomaji = [];
            checked.each(function() {
                allRomaji.push($(this).val());
            });
            
            writingData = generateWritingQuestions(allRomaji);
            currentWritingIndex = 0;
            correctCount = 0;
            wrongCount = 0;
            currentSessionAnswers = [];
            
            $('#page-select-mode').addClass('hidden');
            $('#page-writing').removeClass('hidden');
            
            startTime = Date.now();
            startWritingTimer();
            showWritingQuestion();
        }

        function generateWritingQuestions(allRomaji, numQuestions = 10) {
            const questions = [];
            const shuffled = shuffleArray(allRomaji);
            
            for (let i = 0; i < Math.min(numQuestions, Math.floor(allRomaji.length / 3)); i++) {
                const sequenceLength = Math.min(3 + Math.floor(i / 3), 5);
                const startIdx = i * 2;
                const sequence = [];
                
                for (let j = 0; j < sequenceLength && startIdx + j < shuffled.length; j++) {
                    sequence.push(shuffled[(startIdx + j) % shuffled.length]);
                }
                
                if (sequence.length >= 3) {
                    questions.push({
                        sequence: sequence,
                        options: shuffleArray([...new Set([...sequence, ...shuffleArray(allRomaji).slice(0, 10)])])
                    });
                }
            }
            
            return questions.slice(0, numQuestions);
        }

        function startWritingTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                $('#writing-timer').text(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);
            }, 1000);
        }

        function showWritingQuestion() {
            if (currentWritingIndex >= writingData.length) {
                endQuiz();
                return;
            }
            
            const question = writingData[currentWritingIndex];
            currentWritingQuestion = question.sequence;
            currentWritingAnswer = [];
            
            $('#writing-current-question').text(currentWritingIndex + 1);
            $('#writing-total-questions').text(writingData.length);
            $('#writing-prompt').text(question.sequence.join(' '));
            
            $('#writing-answer').empty();
            $('#writing-answer').append('<span class="text-gray-400 italic" id="writing-placeholder">Klik huruf di bawah...</span>');
            
            const optionsContainer = $('#writing-options');
            optionsContainer.empty();
            
            question.options.forEach(romaji => {
                const char = selectedChars[romaji];
                optionsContainer.append(`
                    <button onclick="selectWritingChar('${romaji}')" class="writing-option bg-white border-2 border-gray-300 hover:border-purple-400 hover:bg-purple-50 text-gray-800 font-bold py-6 px-4 rounded-lg transition duration-200">
                        <div class="text-4xl">${char}</div>
                    </button>
                `);
            });
        }

        function selectWritingChar(romaji) {
            if (currentWritingAnswer.length >= currentWritingQuestion.length) {
                return;
            }
            
            currentWritingAnswer.push(romaji);
            updateWritingAnswer();
        }

        function updateWritingAnswer(showFeedback = false) {
            const answerContainer = $('#writing-answer');
            answerContainer.empty();
            
            if (currentWritingAnswer.length === 0) {
                answerContainer.append('<span class="text-gray-400 italic" id="writing-placeholder">Klik huruf di bawah...</span>');
            } else {
                currentWritingAnswer.forEach((romaji, index) => {
                    const char = selectedChars[romaji];
                    const isCorrect = romaji === currentWritingQuestion[index];
                    
                    let colorClass;
                    if (showFeedback) {
                        colorClass = isCorrect ? 'bg-green-100 border-green-400 text-green-800' : 'bg-red-100 border-red-400 text-red-800';
                    } else {
                        colorClass = 'bg-blue-50 border-blue-400 text-blue-800';
                    }
                    
                    answerContainer.append(`
                        <div class="inline-flex items-center justify-center border-2 ${colorClass} rounded-lg p-3">
                            <div class="text-3xl">${char}</div>
                        </div>
                    `);
                });
            }
        }

        function clearWritingAnswer() {
            currentWritingAnswer = [];
            updateWritingAnswer();
        }

        function submitWritingAnswer() {
            if (currentWritingAnswer.length !== currentWritingQuestion.length) {
                alert('Lengkapi semua huruf dulu!');
                return;
            }
            
            const submitBtn = $('button:contains("Kirim Jawaban")');
            submitBtn.prop('disabled', true);
            submitBtn.removeClass('bg-purple-500 hover:bg-purple-600');
            submitBtn.addClass('bg-gray-400 cursor-not-allowed');
            
            updateWritingAnswer(true);
            
            const allCorrect = currentWritingAnswer.every((romaji, index) => romaji === currentWritingQuestion[index]);
            
            if (allCorrect) {
                correctCount++;
                submitBtn.html('‚úÖ Benar!');
            } else {
                wrongCount++;
                submitBtn.html('‚ùå Salah!');
            }
            
            currentWritingQuestion.forEach((romaji, index) => {
                const isCorrect = currentWritingAnswer[index] === romaji;
                updateCharStats(selectedType, romaji, isCorrect);
                currentSessionAnswers.push({ romaji, isCorrect });
            });
            
            setTimeout(() => {
                submitBtn.prop('disabled', false);
                submitBtn.removeClass('bg-gray-400 cursor-not-allowed');
                submitBtn.addClass('bg-purple-500 hover:bg-purple-600');
                submitBtn.html('Kirim Jawaban');
                
                currentWritingIndex++;
                showWritingQuestion();
            }, 1500);
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                $('#timer').text(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);
            }, 1000);
        }

        function showQuestion() {
            if (currentQuestionIndex >= quizData.length) {
                endQuiz();
                return;
            }
            
            const question = quizData[currentQuestionIndex];
            $('#current-question').text(currentQuestionIndex + 1);
            $('#total-questions').text(quizData.length);
            $('#question-char').text(question.char);
            
            const options = generateOptions(question.correct);
            const answerOptions = $('#answer-options');
            answerOptions.empty();
            
            options.forEach(option => {
                answerOptions.append(`
                    <button onclick="checkAnswer('${option}', '${question.correct}')" class="answer-btn bg-gray-100 hover:bg-blue-100 text-gray-800 font-bold py-6 px-4 rounded-lg transition duration-200 text-xl">
                        ${option}
                    </button>
                `);
            });
        }

        function generateOptions(correct) {
            const allOptions = Object.keys(selectedChars);
            const options = [correct];
            
            while (options.length < 4 && options.length < allOptions.length) {
                const random = allOptions[Math.floor(Math.random() * allOptions.length)];
                if (!options.includes(random)) {
                    options.push(random);
                }
            }
            
            return shuffleArray(options);
        }

        function checkAnswer(selected, correct) {
            $('.answer-btn').prop('disabled', true);
            
            const isCorrect = selected === correct;
            
            if (isCorrect) {
                correctCount++;
                event.target.classList.add('bg-green-500', 'text-white');
                event.target.classList.remove('bg-gray-100', 'text-gray-800');
            } else {
                wrongCount++;
                event.target.classList.add('bg-red-500', 'text-white');
                event.target.classList.remove('bg-gray-100', 'text-gray-800');
                
                $('.answer-btn').each(function() {
                    if ($(this).text().trim() === correct) {
                        $(this).addClass('bg-green-500 text-white');
                        $(this).removeClass('bg-gray-100 text-gray-800');
                    }
                });
            }
            
            updateCharStats(selectedType, correct, isCorrect);
            currentSessionAnswers.push({ romaji: correct, isCorrect });
            
            setTimeout(() => {
                currentQuestionIndex++;
                showQuestion();
            }, 1000);
        }

        function endQuiz() {
            clearInterval(timerInterval);
            
            let totalQuestions, elapsed;
            
            if (currentMode === 'paragraph') {
                totalQuestions = paragraphData.length;
                elapsed = Math.floor((Date.now() - paragraphStartTime) / 1000);
            } else if (currentMode === 'writing') {
                totalQuestions = writingData.length;
                elapsed = Math.floor((Date.now() - startTime) / 1000);
            } else {
                totalQuestions = quizData.length;
                elapsed = Math.floor((Date.now() - startTime) / 1000);
            }
            
            const score = Math.round((correctCount / totalQuestions) * 100);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            $('#final-score').text(score);
            $('#correct-answers').text(correctCount);
            $('#wrong-answers').text(wrongCount);
            $('#time-taken').text(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);
            
            saveSessionToHistory(score, elapsed);
            showImprovementMessage(score);
            
            $('#page-quiz').addClass('hidden');
            $('#page-writing').addClass('hidden');
            $('#page-paragraph').addClass('hidden');
            $('#page-results').removeClass('hidden');
        }

        function saveSessionToHistory(score, timeInSeconds) {
            const stats = getStats();
            const today = new Date().toISOString().split('T')[0];
            
            stats.totalSessions++;
            stats.lastPlayed = today;
            
            stats.sessionHistory.unshift({
                date: today,
                type: selectedType,
                score: score,
                time: timeInSeconds,
                correct: correctCount,
                wrong: wrongCount
            });
            
            if (stats.sessionHistory.length > 10) {
                stats.sessionHistory = stats.sessionHistory.slice(0, 10);
            }
            
            saveStats(stats);
        }

        function showImprovementMessage(currentScore) {
            const stats = getStats();
            const recentSessions = stats.sessionHistory.filter(s => s.type === selectedType);
            
            if (recentSessions.length > 1) {
                const lastScore = recentSessions[1].score;
                const improvement = currentScore - lastScore;
                
                if (improvement > 0) {
                    $('#improvement-message p').text(`üéâ Score kamu meningkat ${improvement}% dari sesi terakhir!`);
                    $('#improvement-message').removeClass('hidden bg-yellow-50 border-yellow-300');
                    $('#improvement-message').addClass('bg-green-50 border-green-300');
                    $('#improvement-message').removeClass('hidden');
                } else if (improvement < 0) {
                    $('#improvement-message p').text(`üí™ Jangan menyerah! Terus latihan ya!`);
                    $('#improvement-message').removeClass('hidden bg-green-50 border-green-300');
                    $('#improvement-message').addClass('bg-yellow-50 border-yellow-300');
                    $('#improvement-message').removeClass('hidden');
                } else {
                    $('#improvement-message').addClass('hidden');
                }
            } else {
                $('#improvement-message').addClass('hidden');
            }
        }

        function restartQuiz() {
            $('#page-results').addClass('hidden');
            $('#page-select-chars').removeClass('hidden');
        }

        function backToStart() {
            $('#page-results').addClass('hidden');
            $('#page-stats').addClass('hidden');
            $('#page-select-type').removeClass('hidden');
        }

        function showStats() {
            $('#page-select-type').addClass('hidden');
            $('#page-stats').removeClass('hidden');
            
            renderStats();
        }

        function renderStats() {
            const stats = getStats();
            
            $('#stat-total-sessions').text(stats.totalSessions);
            
            const totalAttempts = stats.hiraganaStats.totalAttempts + stats.katakanaStats.totalAttempts;
            const totalCorrect = stats.hiraganaStats.correctCount + stats.katakanaStats.correctCount;
            const accuracy = totalAttempts > 0 ? Math.round((totalCorrect / totalAttempts) * 100) : 0;
            $('#stat-accuracy').text(accuracy + '%');
            
            const totalTime = stats.sessionHistory.reduce((sum, s) => sum + s.time, 0);
            const totalMinutes = Math.floor(totalTime / 60);
            $('#stat-total-time').text(totalMinutes + 'm');
            
            const streak = calculateStreak();
            $('#stat-streak').text(streak);
            
            renderProgressChart(stats.sessionHistory);
            renderWeakAndMasteredChars();
        }

        function renderProgressChart(sessionHistory) {
            const ctx = document.getElementById('progress-chart');
            
            if (progressChart) {
                progressChart.destroy();
            }
            
            const sessions = sessionHistory.slice(0, 10).reverse();
            const labels = sessions.map((s, i) => `Sesi ${i + 1}`);
            const hiraganaData = sessions.map(s => s.type === 'hiragana' ? s.score : null);
            const katakanaData = sessions.map(s => s.type === 'katakana' ? s.score : null);
            
            progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Hiragana',
                            data: hiraganaData,
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.3,
                            spanGaps: true
                        },
                        {
                            label: 'Katakana',
                            data: katakanaData,
                            borderColor: 'rgb(168, 85, 247)',
                            backgroundColor: 'rgba(168, 85, 247, 0.1)',
                            tension: 0.3,
                            spanGaps: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });
        }

        function renderWeakAndMasteredChars() {
            const hiraganaWeak = getWeakChars('hiragana', 10);
            const katakanaWeak = getWeakChars('katakana', 10);
            const allWeak = [...hiraganaWeak, ...katakanaWeak]
                .sort((a, b) => a.accuracy - b.accuracy)
                .slice(0, 5);
            
            const weakList = $('#weak-chars-list-stats');
            if (allWeak.length > 0) {
                weakList.empty();
                allWeak.forEach(char => {
                    weakList.append(`
                        <div class="flex justify-between items-center bg-red-50 p-3 rounded">
                            <span class="font-semibold">${char.romaji}</span>
                            <span class="text-sm text-red-600">${Math.round(char.accuracy)}% akurasi</span>
                        </div>
                    `);
                });
            }
            
            const hiraganaGood = getMasteredChars('hiragana');
            const katakanaGood = getMasteredChars('katakana');
            const allGood = [...hiraganaGood, ...katakanaGood]
                .sort((a, b) => b.accuracy - a.accuracy)
                .slice(0, 5);
            
            const masteredList = $('#mastered-chars-list');
            if (allGood.length > 0) {
                masteredList.empty();
                allGood.forEach(char => {
                    masteredList.append(`
                        <div class="flex justify-between items-center bg-green-50 p-3 rounded">
                            <span class="font-semibold">${char.romaji}</span>
                            <span class="text-sm text-green-600">${Math.round(char.accuracy)}% akurasi</span>
                        </div>
                    `);
                });
            }
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
    </script>
</body>
</html>
